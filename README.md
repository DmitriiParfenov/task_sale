# task_sale

Task sale — это решение для задания по ТЗ: </br>
Необходимо реализовать модель сети по продаже электроники на Django и Django Rest Framework: </br>
1. Сеть должна представлять собой иерархическую структуру из 3 уровней: </br>
- `Завод`; </br>
- `Розничная сеть`; </br>
- `Индивидуальный предприниматель`; </br>
Каждое звено сети ссылается только на одного поставщика оборудования (не обязательно предыдущего по иерархии). 
Важно отметить, что уровень иерархии определяется не названием звена, а отношением к остальным элементам сети, т.е. 
завод всегда находится на 0 уровне, а если розничная сеть относится напрямую к заводу, минуя остальные звенья - её уровень - 1
2. Каждое звено сети должно обладать следующими элементами. </br>
- `Название`; </br>
- `Контакты`: </br>
  - `Email`; </br>
  - `Страна`; </br>
  - `Город`; </br>
  - `Улица`; </br>
  - `Номер дома`; </br>
- `Продукты`: </br>
  - `Название`; </br>
  - `Модель`; </br>
  - `Дата выхода продукта на рынок`; </br>
- `Поставщик (предыдущий по иерархии объект сети)`; </br>
- `Задолженность перед поставщиком в денежном выражении с точностью до копеек`; </br>
- `Время создания (заполняется автоматически при создании)`. </br>
3. Сделать вывод в админ-панели созданных объектов. </br>
- `ссылку на «Поставщика»`; </br>
- `фильтр по названию города`: </br>
- `«admin action», очищающий задолженность перед поставщиком у выбранных объектов`: </br>
4. Используя DRF, создать набор представлений. </br>
CRUD для модели поставщика (запретить обновление через API поля «Задолженность перед поставщиком»);
Добавить возможность фильтрации объектов по определенной стране.
5. Настроить права доступа к API так, чтобы только активные сотрудники имели доступ к API.

# Дополнительная информация

- Для создания суперпользователя из директории `task_sale` выполните в консоли: </br>
```
python manage.py csu
```
- Для просмотра покрытия кода тестами введите в консоли:
```
coverage run --source='.' manage.py test
coverage report
```
- Для получения качественного анализа программного кода введите в консоли:
```
flake8 --config .flake8
```

# Клонирование репозитория

В проекте для управления зависимостями используется [poetry](https://python-poetry.org/). </br>
Выполните в консоли: </br>

Для Windows: </br>
```
git clone git@github.com:DmitriiParfenov/task_sale.git
python -m venv venv
venv\Scripts\activate
pip install poetry
poetry install
```

Для Linux: </br>
```
git clone git@github.com:DmitriiParfenov/task_sale.git
python3 -m venv venv
source venv/bin/activate
curl -sSL https://install.python-poetry.org | python3
poetry install
```
# Установка и настройка Redis

- Установите Redis, если он не установлен. Для этого выполните в консоли:
```
sudo apt install redis-server
``` 
- Запустите Redis, выполнив в консоли:
```
sudo service redis-server start
``` 
- Произойдет запуск Redis сервера на порту 6379. Для того, чтобы убедиться, что сервер запущен, необходимо выполнить
в консоли команду, ответом которой должен быть `PONG`.
```
redis-cli ping
```

# Работа с базой данной PostgreSQL

- Установите PostgreSQL, если он не установлен. Для этого, например для Ubuntu, выполните в консоли:
```
sudo apt install postgresql
```
- Выполните вход в интерактивную оболочку PostgreSQL от имени `postgresql`, выполнив в консоли:
```
sudo -i -u postgres psql
```
- Создайте базу данный для проекта, выполнив в консоли:
```
CREATE DATABASE task_sale;
```
- Закройте интерактивную оболочку PostgreSQL:
```
\q
```
# Работа с переменными окружения

- В директории `task_sale` создайте файл `.env`. Пример содержимого файла:
- Пример содержимого файла `.env` для запуска сервиса через docker:
```
HOST=название текущего хоста — db (из docker-compose)
NAME=название базы данных — postgres
USER=имя текущего пользователя — postgres
PASSWORD=пароль текущего пользователя — ваш пароль

POSTGRES_USER=имя пользователя — postgres
POSTGRES_PASSWORD=пароль пользователя — ваш пароль 
POSTGRES_DB=название базы данных для подключения из docker — db (из docker-compose)

EMAIL_BACKEND=путь импорта Python для вашего класса бэкенда
EMAIL_HOST=хост SMTP
EMAIL_HOST_USER=адрес электронной почты для аутентификации на почтовом сервере
EMAIL_HOST_PASSWORD=пароль для аутентификации на почтовом сервере

LOCATION=местоположение используемого кеша (redis://redis:6379)
``` 
- Пример содержимого файла `.env` для запуска сервиса на локальной машине без docker:
```
HOST=название текущего хоста — localhost
NAME=название базы данных — task_sale
USER=имя текущего пользователя — postgres
PASSWORD=пароль текущего пользователя — ваш пароль

EMAIL_BACKEND=путь импорта Python для вашего класса бэкенда
EMAIL_HOST=хост SMTP
EMAIL_HOST_USER=адрес электронной почты для аутентификации на почтовом сервере
EMAIL_HOST_PASSWORD=пароль для аутентификации на почтовом сервере

LOCATION=местоположение используемого кеша (redis://127.0.0.1:6379)
``` 

# Работа с миграциями

Из директории `task_sale` выполните в консоли: </br>

```
python manage.py migrate
```

# Запуск сервера Django

- Активируйте виртуальное окружение согласно п. `Клонирование репозитория` </br>

- Из директории `task_sale` выполните в консоли: </br>
```
python3 manage.py runserver
```

# Запуск сервера Django c использованием docker-compose

- Установите `docker` согласно инструкции на сайте [docker](https://www.docker.com/get-started/). </br>
- Запустите образ для запуска нескольких контейнеров с использованием `docker-compose`. Для этого из директории `task_sale` выполните в консоли: </br>
```
docker-compose build
```
- Запустите собранный образ. Для этого из директории `task_sale` выполните в консоли: </br>
```
docker-compose up
```
- Или для запуска образа в фоновом режим из директории `task_sale` выполните в консоли: </br>
```
docker-compose up -d
```
- В новой открытой сессии создайте суперпользователя. Для этого из директории `task_sale` выполните в консоли: </br>
```
docker-compose exec web python manage.py csu
```
- Сервис будет доступен по URL `http://127.0.0.1:8000/` </br>
- Для остановки работы образа из директории `task_sale` в консоли нажмите `CTRL + C`: </br>
- Для удаления остановленного образа из директории `task_sale` в консоли выполните: </br>
```
docker-compose down
```